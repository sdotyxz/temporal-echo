# 核心玩法任务

## 阶段1：基础 (0:00-0:35)

### 1.1 玩家移动
**时间**: 10分钟
**文件**: `src/player.gd`, `scenes/player.tscn`

- [ ] 1.1.1 使用CharacterBody2D创建玩家场景
- [ ] 1.1.2 实现WASD移动（200 px/s）
- [ ] 1.1.3 添加鼠标瞄准追踪（精灵旋转）
- [ ] 1.1.4 创建基础玩家精灵（蓝色矩形）
- [ ] 1.1.5 添加碰撞形状（32x32）

**验收标准**:
- 玩家在所有方向平滑移动
- 精灵旋转面向鼠标光标
- 无输入延迟

---

### 1.2 历史记录系统
**时间**: 15分钟
**文件**: `src/player.gd`

- [ ] 1.2.1 创建HistoryFrame类（位置、瞄准方向）
- [ ] 1.2.2 初始化历史数组（最大180帧）
- [ ] 1.2.3 每_physics_process记录位置
- [ ] 1.2.4 每_physics_process记录瞄准方向
- [ ] 1.2.5 实现循环缓冲区（满时pop_front）
- [ ] 1.2.6 添加get_frame_from_3s_ago()方法

**验收标准**:
- 历史存储恰好3秒数据
- 位置和瞄准同步
- 内存使用恒定

---

### 1.3 回声生成
**时间**: 10分钟
**文件**: `src/echo.gd`, `scenes/echo.tscn`, `src/player.gd`

- [ ] 1.3.1 使用Area2D创建回声场景
- [ ] 1.3.2 添加回声精灵（青色，50%透明）
- [ ] 1.3.3 实现spawn_echo(spawn_pos, aim_dir)函数
- [ ] 1.3.4 玩家开火3秒后触发生成
- [ ] 1.3.5 回声0.1秒延迟后自动开火
- [ ] 1.3.6 添加幽灵拖尾效果（可选）

**验收标准**:
- 回声恰好3秒后生成
- 回声在正确历史位置生成
- 回声在正确方向开火

---

## 阶段2：战斗 (0:35-1:15)

### 2.1 子弹物理
**时间**: 15分钟
**文件**: `src/bullet.gd`, `scenes/bullet.tscn`

- [ ] 2.1.1 使用Area2D创建子弹场景
- [ ] 2.1.2 实现线性移动（velocity * delta）
- [ ] 2.1.3 添加墙壁碰撞检测
- [ ] 2.1.4 实现镜面反弹（45°入射 = 45°反射）
- [ ] 2.1.5 追踪反弹次数（最多3次）
- [ ] 2.1.6 每次反弹速度+20%
- [ ] 2.1.7 第3次反弹后销毁子弹

**验收标准**:
- 子弹以恒定速度移动
- 反弹遵循镜面反射
- 每次反弹速度正确增加

---

### 2.2 子弹视觉
**时间**: 5分钟
**文件**: `src/bullet.gd`

- [ ] 2.2.1 创建子弹精灵（8x8白色方块）
- [ ] 2.2.2 每次反弹改变颜色：
  - [ ] 0次反弹：白色
  - [ ] 1次反弹：黄色
  - [ ] 2次反弹：橙色
  - [ ] 3次反弹：红色
- [ ] 2.2.3 回声子弹使用青色
- [ ] 2.2.4 反弹时添加缩放脉冲（可选）

**验收标准**:
- 每次反弹颜色可见变化
- 回声子弹与玩家子弹区分明显

---

### 2.3 轨迹预览
**时间**: 15分钟
**文件**: `src/trajectory_preview.gd`

- [ ] 2.3.1 使用Line2D创建TrajectoryPreview节点
- [ ] 2.3.2 实现路径预测的raycast计算
- [ ] 2.3.3 计算最多3个反弹点
- [ ] 2.3.4 瞄准时渲染虚线
- [ ] 2.3.5 玩家瞄准时实时更新
- [ ] 2.3.6 射击后隐藏线条

**验收标准**:
- 玩家瞄准时显示线条
- 准确预测反弹点
- 性能：计算时间 < 1ms

---

### 2.4 Boss AI
**时间**: 15分钟
**文件**: `src/boss.gd`, `scenes/boss.tscn`

- [ ] 2.4.1 使用CharacterBody2D创建Boss场景
- [ ] 2.4.2 添加Boss精灵（红色矩形，64x64）
- [ ] 2.4.3 实现追击AI（以80 px/s向玩家移动）
- [ ] 2.4.4 添加"始终面向玩家"旋转
- [ ] 2.4.5 实现10 HP生命系统
- [ ] 2.4.6 添加接触伤害（玩家失去1 HP）

**验收标准**:
- Boss向玩家移动
- Boss精灵持续面向玩家
- HP系统正常工作

---

## 阶段3：游戏循环 (1:15-2:00)

### 3.1 伤害系统
**时间**: 10分钟
**文件**: `src/boss.gd`, `src/bullet.gd`

- [ ] 3.1.1 实现子弹-Boss碰撞检测
- [ ] 3.1.2 单颗子弹造成1点伤害
- [ ] 3.1.3 检测同时命中（0.1秒窗口）
- [ ] 3.1.4 双重命中造成2点伤害
- [ ] 3.1.5 添加视觉反馈（0.1秒红色闪烁）
- [ ] 3.1.6 更新Boss血条

**验收标准**:
- Boss从子弹受到伤害
- 双重命中检测工作
- 视觉反馈清晰

---

### 3.2 玩家生命值
**时间**: 5分钟
**文件**: `src/player.gd`

- [ ] 3.2.1 实现3 HP系统
- [ ] 3.2.2 检测Boss接触伤害
- [ ] 3.2.3 添加受伤后1秒无敌
- [ ] 3.2.4 添加视觉反馈（红色闪烁）
- [ ] 3.2.5 更新玩家血条

**验收标准**:
- Boss接触时玩家失去HP
- 无敌帧工作
- 视觉反馈清晰

---

### 3.3 胜负条件
**时间**: 10分钟
**文件**: `src/game_manager.gd`

- [ ] 3.3.1 检测Boss死亡（HP降至0）
- [ ] 3.3.2 检测玩家死亡（HP降至0）
- [ ] 3.3.3 显示胜利画面（文字+计时器）
- [ ] 3.3.4 显示游戏结束画面
- [ ] 3.3.5 添加重新开始功能（R键或按钮）

**验收标准**:
- Boss死亡时触发胜利
- 玩家死亡时触发游戏结束
- 可以重新开始游戏

---

### 3.4 UI/HUD
**时间**: 10分钟
**文件**: `scenes/ui.tscn` 或 `scenes/game.tscn`

- [ ] 3.4.1 创建Boss血条（ProgressBar）
- [ ] 3.4.2 创建玩家血条（ProgressBar）
- [ ] 3.4.3 添加游戏计时器（2分钟倒计时）
- [ ] 3.4.4 使用可读颜色样式化UI
- [ ] 3.4.5 将UI定位在角落（不遮挡游戏）

**验收标准**:
- 血条实时更新
- 计时器正确倒计时
- UI可读且不突兀

---

## 阶段4：打磨 (2:00-2:50)

### 4.1 音频
**时间**: 15分钟
**文件**: `src/audio_manager.gd`, `assets/audio/`

- [ ] 4.1.1 导入Kenney数字音频文件
- [ ] 4.1.2 实现开火音效（laser_charge）
- [ ] 4.1.3 实现回声生成音效（time_warp）
- [ ] 4.1.4 实现反弹音效（metallic_ping + 音调）
- [ ] 4.1.5 实现命中音效（deep_impact, error_buzz）
- [ ] 4.1.6 添加背景音乐循环（30秒环境音）

**验收标准**:
- 所有关键事件有音频
- 每次反弹音调增加
- 音乐无缝循环

---

### 4.2 屏幕效果
**时间**: 10分钟
**文件**: `src/game_manager.gd`

- [ ] 4.2.1 双重命中时添加屏幕震动（0.2秒，2px）
- [ ] 4.2.2 玩家受伤时添加闪烁效果
- [ ] 4.2.3 回声生成时添加色差效果（可选）
- [ ] 4.2.4 冲刺时添加运动模糊（可选）

**验收标准**:
- 效果增强游戏
- 不压倒性或分散注意力
- 性能保持60 FPS

---

### 4.3 视觉打磨
**时间**: 10分钟
**文件**: 多个

- [ ] 4.3.1 添加竞技场背景（深灰）
- [ ] 4.3.2 样式化墙壁（钢灰矩形）
- [ ] 4.3.3 添加玩家发光效果（可选）
- [ ] 4.3.4 添加Boss发光效果（可选）
- [ ] 4.3.5 确保所有效果下60 FPS

**验收标准**:
- 视觉清晰可读
- 颜色符合设计文档
- 性能60 FPS

---

### 4.4 Bug修复
**时间**: 15分钟
**文件**: 多个

- [ ] 4.4.1 修复回声生成时机问题（帧完美）
- [ ] 4.4.2 修复反弹角度边界情况（角落）
- [ ] 4.4.3 修复碰撞检测（子弹穿墙）
- [ ] 4.4.4 修复UI更新延迟
- [ ] 4.4.5 测试内存泄漏（预期无）

**验收标准**:
- 无游戏破坏性Bug
- 流畅60 FPS游戏
- 无崩溃或冻结

---

## 阶段5：打包 (2:50-3:00)

### 5.1 导出
**时间**: 5分钟
**文件**: 导出预设

- [ ] 5.1.1 配置Windows导出预设
- [ ] 5.1.2 配置Web/HTML5导出预设
- [ ] 5.1.3 导出Windows构建（.exe）
- [ ] 5.1.4 导出Web构建（.html + .js）
- [ ] 5.1.5 测试两个构建正确运行

**验收标准**:
- 两个构建无错误导出
- 游戏在编辑器外运行
- 无缺失资源

---

### 5.2 Itch.io上传
**时间**: 5分钟
**文件**: 浏览器

- [ ] 5.2.1 为时间回声创建itch.io页面
- [ ] 5.2.2 上传Windows构建
- [ ] 5.2.3 上传Web构建（设为首要）
- [ ] 5.2.4 添加游戏描述（一句话介绍）
- [ ] 5.2.5 添加截图（可选）
- [ ] 5.2.6 提交到TriJam #358

**验收标准**:
- 页面上线且公开
- 构建可下载/可玩
- 成功提交到GameJam

---

## 总结

| 阶段 | 时间 | 任务 | 产出 |
|------|------|------|------|
| 1. 基础 | 0:35 | 16 | 玩家移动，回声生成 |
| 2. 战斗 | 0:40 | 17 | 子弹反弹，Boss追击 |
| 3. 游戏循环 | 0:45 | 15 | 能赢能输，UI工作 |
| 4. 打磨 | 0:50 | 18 | 音频，效果，Bug修复 |
| 5. 打包 | 0:10 | 11 | 已导出，在itch.io |
| **总计** | **3:00** | **77任务** | **完整游戏** |

## 应急计划

如果进度落后，按此顺序削减：

| 优先级 | 功能 | 节省时间 |
|----------|---------|------------|
| 1 | 轨迹预览 | 15分钟 |
| 2 | 屏幕效果 | 10分钟 |
| 3 | 冲刺能力 | 10分钟 |
| 4 | 反弹加速 | 5分钟 |
| 5 | 音频 | 15分钟 |
| 6 | 回声拖尾效果 | 5分钟 |

**最小可行产品**（如果只剩1小时）：
- 玩家移动和射击
- 子弹反弹一次
- 回声3秒后生成
- Boss有HP
- 能赢能输
